name: cencurity-community

services:
  gateway:
    image: nginx:1.27-alpine
    container_name: cencurity-community-gateway
    restart: unless-stopped
    depends_on:
      - cencurity
    ports:
      - "18080:18080"
      - "18082:18082"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro

  cencurity:
    # Deploy-only repo: pull a prebuilt image (no source code required here).
    # Set CENCURITY_IMAGE in .env to your published image (Docker Hub / GHCR).
    image: ${CENCURITY_IMAGE:-cencurity-community:latest}
    pull_policy: ${CENCURITY_PULL_POLICY:-if_not_present}
    container_name: cencurity-community
    restart: unless-stopped

    environment:
      - CENCURITY_MODE=customer
      - CENCURITY_ENV=prod
      # Required so the in-container connector can attach to /gateway-ws in prod mode.
      - GATEWAY_CONNECTOR_TOKEN=community-local-connector-token
      # Optional hardening
      # - JWT_SECRET=change_me

    # Completely separate data folder (won't touch repo-root ./data)
    volumes:
      - ./data:/app/data
